name: EC2 Production Deployment
on:
  push:
      branches:
        - main
  workflow_dispatch:
env:
  COCK: "hello"
  SSH_PRIVATE_KEY: ""
  REMOTE_HOST: "ec2-3-83-11-18.compute-1.amazonaws.com"
  REMOTE_USER: "ubuntu"
jobs:
  Deploy:
    name: Deploy to EC2
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v2 
      - name: Build & Deploy      
        run: |
          echo '-----BEGIN RSA PRIVATE KEY-----MIIEpAIBAAKCAQEAhOUqC2w+wEY5LCLvF6jv0jRBM6FmrMNUUpsk7ifheFa7s6XOixekynVjazP7A1LtpugQ8dJs1SjB5Tirqt/BjszhzwdXNlyeAxlzOCZQdHbr8S0L8v6CmSLW6nAYBfBX2AwOiFaIAZFCysIbm4VMWioI0OUCXIlD2utUixPC32yoOKyiaB3tUo8eTWl0WNeXTEA9gQnX/hxzr6X4+pFQJBEQXwyokIQ0S8un0PB+1Wt6XaZk/bxVc2dDNiIv1sjPTPyigYv6d/8beCjajU8j5TjnDviRoSPqRLcZ5HtLYMZlou6KIwGFfFj7QsRYUVod2W0s605SZYscAzrqMD4A3QIDAQABAoIBACnZeLoMJl6qPorVnXFX893AMuAtbYXuJPm2fZS53ljlB0r1ZeuLUIupF9vEjMFpNgmffuaIG1ms8hJbHEQ9Hlj30AxABYjK9b+IHi6Kcj+ay4YxZ1foKfxLal59WjNUknUoptLsXPwRYHU1VzhMa9Tg89HErE+zsjiYbxE08eMlgepn/ruIivNcTGErDT0qRn/5n47i9meYwpy0BVGSaZeM91QCP442F2zUooftZrInxmZPffwOLhAOmn9MZwfrURLqgdXE0KdpLGvu2dpRuon+QXvZlVlKZs//m3hCLrOT9eI9NFNJMV+Z2QpeMZFCnqpFwmgv7PpoN672FviS4wECgYEAyGNosGdoHD8ONEMgJI0hvuiABEtwgRowgHfFmC2rZwCbOXySzLH7flJkJeXte4h7l4WDPKlpYKuz9TChE9/omIYcgwloo9PsJ6N89wVKjQmCjs2iLYW4jlRedel6gmgB5zM0xEWlMvX+4dSHLfxp7q7McJ1hcV2f7AHta1UEOmECgYEAqca0MKzXYHJBx5AWE66Km6ezOsQX2OfAqA4Kk8mArVmpAjaVGqd2muWIKd2ESGXjf+5qs69YQ4UIC0meGz2s32XnYe2ZRfd7korf9vd8+YziryiQs4I0W3AORVy0I6zLnuI0MkWv0eg7R3KqE3CyXLQ8ZrDIkdAb/CP2kSgor/0CgYEAx/zeOF+bOcV8aZAsfg4UBbGIQcEAcPgwO6ZNH4lErLGgOQkogP2IHxQfOutzzXvyzM/EoD/7GS2DlkqIF4u5WK9PuT8knYwc/ZpeVzGCq6s4D0kOeBwiinmNJGR1jbw7WgBywwc2zdtQGxW+K5jkJ/9vrVyEKV3lAucRibL5W0ECgYEAnoUx6eD4mM0WLkeS1X27XesPpmdB/P0nHcM+jQ8wXqvA6pgcUG7ch3SZ1r1GrnK0INd0OaIXP7QO9rseLUFBELYNfZpj6rhRYVraE7axsjCh1/qAYZvJVzchnBIbANRuq0N6iRYYPF4iO2wM8WngoD6Jxzh5jexKtPq/Vnmww+ECgYANVjxXVuUsXPkXTXPyT1FPXHPymZz8Lz+NonI2QQNWDgjsnxk3T1kOMQGmMv+Fn3tisO8/TA6aCRNcPH85bQSTTibJ28ffTgGMua03wwHbAMn8qRaajTt45k9r/UvmTnloWTb8KdLHpHp1IeOm9oVhhNkrxn77SKFb+KntKsbEgg==-----END RSA PRIVATE KEY-----' > private_key && chmod 400 private_key
          ssh -o StrictHostKeyChecking=no -i private_key ubuntu@ec2-3-83-11-18.compute-1.amazonaws.com '

              cd HammerspaceBackend &&
              git checkout main &&
              git fetch --all &&
              git reset --hard origin/main &&
              git pull origin main &&
              pip install -r requirements.txt
              uvicorn main[app]
              '

